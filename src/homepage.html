<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaveMyExam Downloader App</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>
<body x-data="$store.subjectData">
<h1 class="title">SaveMyExam Downloader</h1>
<!-- Textarea for entering download URLs -->
<h4 class="subtitle"><i class="fa-solid fa-download"></i> Selected subject(s) for Download:</h4>
<ul class="selected-list">
    <template x-for="item in $store.subjectData.items" :key="item.id">
        <li :class="{'success': isCompleted(item), 'hasLocation': item?.savedLocation}" @click="openFolder(item)"
            :title="item?.savedLocation ? 'Click to open download folder' : ''"
        >
            <i class="fas fa-circle-check" x-show="isCompleted(item)"></i>
            <span x-text="item.subjectTitle + ' - ' + item.subjectLevel"></span>
            <template x-if="item.totalCount">
                <span x-text="'(' + (item?.downloadedCount??0) + '/' + item.totalCount +')'"></span>
            </template>
        </li>
    </template>
</ul>

<!-- Display the default download path -->
<p class="download-location" title="Click to open folder">
    <strong>Download Folder Location:</strong>
    <span id="download-path"></span>
</p>

<!-- Button to choose a download location -->
<button id="choose-directory-button"><i class="fa-solid fa-folder-open"></i> Choose Download Folder</button>
<p></p>

<!-- Output area for logs -->
<div id="output">
    <template x-for="log in $store.subjectData.logs" :key="log.id">
        <div class="log" :class="{'hasProgressbar': log.percent && log.percent < 100}">
            <span class="progress-wrapper icon fa-fade" x-show="log.percent && log.percent < 100"
                  :title="+ Math.round(log.percent) + '% completed'">
                <svg class="progress-circle" viewBox="0 0 25 25">
                    <circle class="progress-circle__background" cx="12.5" cy="12.5" r="10"></circle>
                    <circle
                            class="progress-circle__foreground"
                            cx="12.5"
                            cy="12.5"
                            r="10"
                            :style="{ strokeDashoffset: progressOffset(log.percent) }"
                            transform="rotate(-90 12.5 12.5)"
                    >

                    </circle>
                    <!-- Percentage text -->
                    <text class="progress-text" x="12.5" y="12.5" x-text="Math.round(log.percent) + '%'"></text>
                </svg>
            </span>
            <span x-html="log.message"></span>
        </div>
    </template>
</div>

<button :disabled="loading || navigationLoading" id="backBtn" title="Back to Subject Selection" @click="redirectBack()">
    <i class="fa-solid fa-arrow-left-long icon" x-show="!navigationLoading"></i>
    <i class="fas fa-circle-notch fa-spin loader" x-show="navigationLoading"></i>
    <span class="btn-label">Back</span>
</button>

<!-- Button to start download -->
<button id="startDownload" :disabled="loading">
    <i class="fas fa-circle-notch fa-spin loader" x-show="loading"></i>
    <i class="fa-solid fa-download icon" x-show="!loading"></i>
    <span class="btn-label" x-text="!loading ? 'Start Download' : 'Downloading...'"></span>
</button>

<h6 class="author" title="Click for view Author Message">MiRzA Haris Â© All right reserved.</h6>

<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>

<!-- Link to the JavaScript file -->
<script src="./renderer.js"></script>
<script>
    function circularProgress() {
        return {
            progress: 78, // Starting percentage
            get progressOffset() {
                const radius = 10; // Updated radius for the 25px circle
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (this.progress / 100) * circumference;

                // Ensure offset is positive and within bounds
                return Math.max(0, Math.min(offset, circumference));
            },
            increase() {
                if (this.progress < 100) {
                    this.progress += 10;
                    if (this.progress > 100) {
                        this.progress = 100;
                    }
                }
            },
            decrease() {
                if (this.progress > 0) {
                    this.progress -= 10;
                }
            }
        }
    }
</script>
</body>
</html>


